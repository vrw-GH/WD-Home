# Deployment of salesforce-datasync-api at AWS ec2 
# https://github.com/marketplace/actions/ftp-deploy
name: Deploy to Server
run-name: ${{ github.actor }} is Publishing Site ğŸš€
on:
  push:
    branches: [ "main" ]
jobs:
  server-deploy:
    name: ğŸ‰ Deploy
    runs-on: ubuntu-latest
    # timeout-minutes: 2 # default 360!
    steps:

      # Pre-run
    - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
    - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
    - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."

    # Get repository code
    - name: Check out repository code
      uses: actions/checkout@v3      
    - run: echo "ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
    - name: List files in the repository
      run: |
        ls ${{ github.workspace }}    
    - run: echo "ğŸ–¥ï¸ The workflow is now ready to Deploy."
    
    # Deployment
    #- name: FTP-Deploy-Action
    #  uses: SamKirkland/FTP-Deploy-Action@v4.3.4
    #  with:
    #    server: ftp.wrightsdesk.com
    #    protocol: ftps
    #    port: 22
    #    username: ${{ secrets.FTP_USR }}
    #    password: ${{ secrets.FTP_PWD }}
    #    local-dir: ./builds/_current/
    #    server-dir: public_html/www/WD2/   # testing  /www/wrightsdesk
    #    log-level: verbose
    #    dry-run: true
    #    # timeout: 30000
    #    # exclude: |
    #      # **/.git* # is default
    #      # **/.git*/** # is default
    #      # **/node_modules/** # is default          
    #      # **/bak*/**
    #      # **/zip*/**
    #      # **/.bak*
    #      # **/.zip*
    - name: FTP/SFTP file deployer
      uses: milanmk/actions-file-deployer@1.12
      with:
        remote-protocol: "sftp"
        remote-host: "ftp.wrightsdesk.com"
        remote-user: "ftp@wrightsdesk.com"
        ssh-private-key: ${{ secrets.FTP_PWD }}
        remote-path: "/WD2/www/wrightsdesk.com"
    - run: echo "ğŸ This job's status is ${{ job.status }}."    
      

# Deployment of salesforce-datasync-api at AWS ec2 
# https://github.com/marketplace/actions/ftp-deploy
name: Deploy to Server
run-name: ${{ github.actor }} is Publishing Site üöÄ
on:
  push:
    branches: [ "main" ]
jobs:
  server-deploy:
    name: üéâ Deploy
    runs-on: ubuntu-latest
    # timeout-minutes: 2 # default 360!
    steps:

      # Pre-run
    - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
    - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
    - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."

    # Get repository checkout
    - name: "Checkout"
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
    - name: List files in the repository
      run: |
        ls ${{ github.workspace }}    
    - run: echo "üñ•Ô∏è The workflow is now ready to Deploy."
    
    # Deployment
    #- name: FTP-Deploy-Action
    #  uses: SamKirkland/FTP-Deploy-Action@v4.3.4
    #  with:
    #    server: ftp.wrightsdesk.com
    #    protocol: ftps
    #    port: 22
    #    username: ${{ secrets.FTP_USR }}
    #    password: ${{ secrets.FTP_PWD }}
    #    local-dir: ./builds/_current/
    #    server-dir: public_html/www/WD2/   # testing  /www/wrightsdesk
    #    log-level: verbose
    #    dry-run: true
    #    # timeout: 30000
    #    # exclude: |
    #      # **/.git* # is default
    #      # **/.git*/** # is default
    #      # **/node_modules/** # is default          
    #      # **/bak*/**
    #      # **/zip*/**
    #      # **/.bak*
    #      # **/.zip*
    
    #- name: FTP/SFTP file deployer
    #  uses: milanmk/actions-file-deployer@1.12
    #  with:
    #    remote-protocol: "sftp"
    #    remote-host: "ftp.wrightsdesk.com"
    #    remote-user: ${{ secrets.FTP_USR }}
    #    remote-password: ${{ secrets.FTP_PWD }}
    #    local-path: "./builds/_current/"
    #    remote-path: "wrightsdesk.com/www/WD2/"
    #    debug: true
        
    - name: FTP Deployer
      uses: sand4rt/ftp-deployer@v1.7
      with:
        sftp: true # optional
        host: ftp.wrightsdesk.com # ${{ secrets.FTP_HOST }} 
        port: 22 # optional, default is: 21
        username: ${{ secrets.FTP_USR }} # FTP username
        password: ${{ secrets.FTP_PWD }} # FTP password
        remote_folder: /www/WD2/ # ${{ secrets.FTP_REMOTE_FOLDER }}
        local_folder: ./builds/_current/ # optional, local path, default is: dist
        cleanup: true # optional, remove existing files inside FTP remote folder
        include: '[]' # optional, e.g. '['dist']'
        exclude: '["*.bak","*.zip",".git*",".git/**"]' # optional, e.g. '['node_modules/**', '.git/**', '*.env']'
        passive: true # optional
        
    - run: echo "üçè This job's status is ${{ job.status }}."    
      
